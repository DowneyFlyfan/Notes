---
id: Track
aliases: []
tags: []
---

# 检测算法

## Harris 角点响应

### 泰勒展开比较二阶导

$$
\begin{equation}
\begin{aligned}
E(u,v) &\approx \sum_{x,y} w(x,y) [I(x+u, y+v) - I(x,y)]^2 \\
&\approx \sum_{x,y} w(x,y) [u I_x + v I_y]^2 \\
&= \sum_{x,y} w(x,y) [u^2 I_x^2 + 2uv I_x I_y + v^2 I_y^2] \\
&= u^2 \sum_{x,y} w(x,y) I_x^2 + 2uv \sum_{x,y} w(x,y) I_x I_y + v^2 \sum_{x,y} w(x,y) I_y^2 \\
&\approx \begin{bmatrix} u & v \end{bmatrix} \begin{bmatrix} \sum w I_x^2 & \sum w I_x I_y \\ \sum w I_x I_y & \sum w I_y^2 \end{bmatrix} \begin{bmatrix} u \\ v \end{bmatrix}
\end{aligned}
\end{equation}
$$

| 参数             | 说明                                             |
| :--------------- | :----------------------------------------------- |
| $w(x,y)$         | 窗口函数 (如**高斯函数**)                        |
| $M$              | 结构张量，通常将 $\sum w(\cdot)$ 简写为 $\Sigma(\cdot)$ |
| $I_x, I_y$       | 图像 $I$ 在 $x$ 和 $y$ 方向的梯度              |

### 检测公式

$$
\begin{equation}
\begin{aligned}
M &= \Sigma \begin{bmatrix} I_x^2 & I_x I_y \\ I_x I_y & I_y^2 \end{bmatrix} \\
R &= \det(M) - k \cdot (\text{trace}(M))^2
\end{aligned}
\end{equation}
$$

- 拥有**旋转不变性**，但是**没有尺度不变性**


| 参数             | 说明                                                                     |
| :--------------- | :----------------------------------------------------------------------- |
| $M$              | 结构张量或二阶矩矩阵，总结了窗口内所有像素的梯度信息                   |
| $I_x$            | 图像在x方向的梯度                                                      |
| $I_y$            | 图像在y方向的梯度                                                      |
| $\Sigma$         | 表示对窗口内所有像素求和                                               |
| $k$              | 经验常数，通常取0.04到0.06之间                                         |
| $\det(M)$        | 矩阵 $M$ 的行列式                                                      |
| $\text{trace}(M)$ | 矩阵 $M$ 的迹                                                          |
| $\lambda_1, \lambda_2$ | 矩阵 $M$ 的两个特征值。当两个特征值都很大时（代表在两个垂直方向上梯度都很大），$R$的值就会很大，说明这是一个角点 |

## Frangi 血管检测

# 匹配算法

## ORB

### 找点过程

1. **oFAST**找点

- 用FAST算法(滑动窗口内有$N$个以上比中心像素点亮的像素，该中心点定为特征点)找出候选特征点

- 用Harris角点打分，筛选出最好的$k$个点。

- 用“强度质心”法，计算出每个点的方向。

2. **rBRIEF**描述点

- 在每个特征点的位置，取出图像块(原论文大小为$31 \times 31$)

- 拿出“学习”好的256个点对采样模式(训练过的随机数对, $256 \times 4 = 1024$)

- 根据特征点的方向，旋转这套采样模式

- 用旋转后的点周围的图像块(原味是$5 \times 5$)对进行亮度比较，生成一个256位的二进制描述子

3. 输出：一堆特征点(位置、方向)和它们对应的二进制描述子(descriptor)

### 点对采样方式学习

1. 准备数据：从一个大型图像数据库（如PASCAL 2006）中，提取出大约30万个特征点图像块。

2. 生成候选点对：在一个31x31像素的图像块内，生成所有可能的点对（论文中提到大约有20多万个候选点对）。

3. 第一轮筛选（寻找高方差）：

- 让所有候选点对在30万个图像块上进行测试。

- 计算每个点对测试结果的均值。

- 按照“均值离0.5的距离”对所有点对进行排序。越接近0.5的，方差越大，排在越前面。我们得到一个列表 T。

4. 第二轮筛选（贪心搜索，去除相关性）：

- 创建一个空的“最终点对”列表 R。

- 将列表 T 中方差最大的点对加入 R。

- 遍历 T 中的剩余点对 d。

- 如果 d 与 R 中现有任何点对的相关性低于设定阈值，则将 d 加入 R。

- 否则，丢弃 d。

- 重复此过程，直到 R 中有256个点对。
